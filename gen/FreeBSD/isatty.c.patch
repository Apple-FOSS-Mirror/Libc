--- isatty.c.orig	2003-05-20 15:21:02.000000000 -0700
+++ isatty.c	2005-06-02 13:46:32.000000000 -0700
@@ -39,14 +39,21 @@
 
 #include <termios.h>
 #include <unistd.h>
+#include <sys/filio.h>
+#include <sys/conf.h>
+#include <errno.h>
 
 int
 isatty(fd)
 	int fd;
 {
-	int retval;
+	int retval, type;
 	struct termios t;
 
-	retval = (tcgetattr(fd, &t) != -1);
+	if(ioctl(fd, FIODTYPE, &type) != -1) {
+	    if((retval = (type == D_TTY)) == 0)
+		errno = ENOTTY;
+	} else
+	    retval = (tcgetattr(fd, &t) != -1);
 	return(retval);
 }
